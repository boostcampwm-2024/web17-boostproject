## ğŸš¨ ì„œë²„ ì‹œì‘í•˜ìë§ˆì ìˆ˜ë°± ê°œì˜ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤ê³ ìš”? - Constructorì—ì„œì˜ ìˆœì°¨ì  ì¿¼ë¦¬ ì‹¤í–‰ í•¨ì •

### 1. ë°œê²¬ëœ ë¬¸ì œ
```typescript
Query: SELECT 1 AS `row_exists` FROM ... WHERE EXISTS (SELECT 1 FROM `stock` WHERE stock_id = ?) 
Parameters: ["040300"]
Query: SELECT 1 AS `row_exists` FROM ... WHERE EXISTS (SELECT 1 FROM `stock` WHERE stock_id = ?) 
Parameters: ["040350"]
// ... ìˆ˜ë°± ê°œì˜ ì¿¼ë¦¬ ê³„ì† ë°œìƒ
```

### 2. ì›ì¸ ë¶„ì„
```typescript
@Injectable()
export class KoreaStockInfoService {
    constructor(...) {
        this.initKoreaStockInfo();  // ìƒì„±ìì—ì„œ ì´ˆê¸°í™” ë©”ì„œë“œ í˜¸ì¶œ
    }

    private async insertStockData(stock: Stock): Promise<void> {
        const exists = await this.existsStockInfo(stock.id!, manager);  // ê°ê°ì˜ ì£¼ì‹ë§ˆë‹¤ EXISTS ì²´í¬
        if (!exists) {
            await manager.save(Stock, stock);
        }
    }
}
```

### 3. í”„ë¡œì„¸ìŠ¤ ë¹„êµ

#### ê¸°ì¡´ ë°©ì‹ (ìˆœì°¨ì  ì‹¤í–‰)
```mermaid
sequenceDiagram
    participant Server
    participant Service
    participant DB
    Server->>Service: ìƒì„±ì í˜¸ì¶œ
    activate Service
    Service->>Service: initKoreaStockInfo()
    loop ê° ì£¼ì‹ë§ˆë‹¤
        Service->>DB: EXISTS ì¿¼ë¦¬
        DB->>Service: ê²°ê³¼ ë°˜í™˜
        opt ì£¼ì‹ì´ ì—†ëŠ” ê²½ìš°
            Service->>DB: INSERT ì¿¼ë¦¬
        end
    end
    deactivate Service
```

#### ê°œì„ ëœ ë°©ì‹ (ë°°ì¹˜ ì²˜ë¦¬)
```mermaid
sequenceDiagram
    participant Server
    participant Service
    participant DB
    Server->>Service: ìƒì„±ì í˜¸ì¶œ
    activate Service
    Service->>Service: ë°ì´í„° ìˆ˜ì§‘
    Service->>DB: IN ì ˆë¡œ í•œë²ˆì— EXISTS ì²´í¬
    DB->>Service: ê²°ê³¼ ë°˜í™˜
    Service->>DB: ìƒˆë¡œìš´ ë°ì´í„° ì¼ê´„ INSERT
    deactivate Service
```

### 4. ê°œì„ ëœ ì½”ë“œ
```typescript
private async insertStockDataBatch(stocks: Stock[]): Promise<void> {
    // í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ì¡´ì¬í•˜ëŠ” ëª¨ë“  stock_id í™•ì¸
    const existingStocks = await manager
        .createQueryBuilder(Stock, "stock")
        .select("stock.id")
        .where("stock.id IN (:...ids)", { 
            ids: stocks.map(s => s.id) 
        })
        .getRawMany();

    // ìƒˆë¡œìš´ ë°ì´í„°ë§Œ í•„í„°ë§
    const existingIds = new Set(existingStocks.map(s => s.id));
    const newStocks = stocks.filter(s => !existingIds.has(s.id));
    
    // ì¼ê´„ ì €ì¥
    if (newStocks.length > 0) {
        await manager.save(Stock, newStocks);
    }
}
```

### 5. ì„±ëŠ¥ ê°œì„  íš¨ê³¼
| í•­ëª© | ê¸°ì¡´ ë°©ì‹ | ê°œì„ ëœ ë°©ì‹ |
|------|-----------|------------|
| DB ì¿¼ë¦¬ ìˆ˜ | ì£¼ì‹ ìˆ˜ Ã— 2 (ìµœëŒ€) | 2 (EXISTS + INSERT) |
| ì‹¤í–‰ ì‹œê°„ | O(n) | O(1) |
| DB ë¶€í•˜ | ë†’ìŒ | ë‚®ìŒ |

### 6. í•µì‹¬ êµí›ˆ
1. ìƒì„±ìì—ì„œ ë¬´ê±°ìš´ ì´ˆê¸°í™” ì‘ì—… ì£¼ì˜
2. ìˆœì°¨ì  ì¿¼ë¦¬ë³´ë‹¤ ë°°ì¹˜ ì²˜ë¦¬ í™œìš©
3. ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ ê³ ë ¤í•œ ì„¤ê³„ í•„ìš”

### 7. ì—°ê´€ëœ íŒ¨í„´
- ìƒì„±ì ì£¼ì… (Constructor Injection)
- ë°°ì¹˜ ì²˜ë¦¬ (Batch Processing)
- ë²Œí¬ ì—°ì‚° (Bulk Operation)
